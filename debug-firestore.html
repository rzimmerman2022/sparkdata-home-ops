<!DOCTYPE html>
<html>
<head>
    <title>Firestore Debug - Active Cleaners</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
        .session { background: white; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #3b82f6; }
        .active { border-left-color: #10b981; }
        .inactive { border-left-color: #ef4444; }
        h1 { color: #333; }
        pre { background: #f0f0f0; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Firestore Debug - Active Cleaners</h1>
    <button onclick="loadSessions()">Reload Sessions</button>
    <div id="output"></div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCVHDGBL70opBifmdnILzrUYEptQsMw708",
            authDomain: "sparkdata-cleaning-checklists.firebaseapp.com",
            projectId: "sparkdata-cleaning-checklists",
            storageBucket: "sparkdata-cleaning-checklists.firebasestorage.app",
            messagingSenderId: "825900465348",
            appId: "1:825900465348:web:d28f2742e527513311dd91"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        async function loadSessions() {
            const output = document.getElementById('output');
            output.innerHTML = '<p>Loading...</p>';

            try {
                // Get ALL sessions (not filtered)
                const allSnapshot = await db.collection('sessions/dec10-2025/cleaners').get();

                let html = '<h2>All Sessions in Firestore</h2>';
                html += `<p>Total sessions found: ${allSnapshot.size}</p>`;

                allSnapshot.forEach(doc => {
                    const data = doc.data();
                    const isActive = data.status === 'active';
                    const startTime = data.startTime ? data.startTime.toDate().toLocaleString() : 'N/A';

                    html += `
                        <div class="session ${isActive ? 'active' : 'inactive'}">
                            <h3>${data.name || 'Unknown'} ${isActive ? 'üü¢ ACTIVE' : 'üî¥ INACTIVE'}</h3>
                            <p><strong>Session ID:</strong> ${doc.id}</p>
                            <p><strong>Status:</strong> ${data.status}</p>
                            <p><strong>Started:</strong> ${startTime}</p>
                            <p><strong>Tasks Completed:</strong> ${data.tasksCompleted || 0}</p>
                            <details>
                                <summary>Full Data</summary>
                                <pre>${JSON.stringify(data, null, 2)}</pre>
                            </details>
                        </div>
                    `;
                });

                // Get only active sessions
                const activeSnapshot = await db.collection('sessions/dec10-2025/cleaners')
                    .where('status', '==', 'active')
                    .get();

                html += '<h2>Active Sessions (Dashboard Query)</h2>';
                html += `<p>Active sessions found: ${activeSnapshot.size}</p>`;

                if (activeSnapshot.empty) {
                    html += '<p style="color: red;">‚ùå No active sessions found by dashboard query!</p>';
                } else {
                    activeSnapshot.forEach(doc => {
                        const data = doc.data();
                        html += `<p>‚úÖ ${data.name} - ${doc.id}</p>`;
                    });
                }

                output.innerHTML = html;

            } catch (error) {
                output.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
                console.error(error);
            }
        }

        // Load on page load
        loadSessions();

        // Auto-refresh every 5 seconds
        setInterval(loadSessions, 5000);
    </script>
</body>
</html>
